<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Canvas ç²’å­è½¬ç›˜æŠ½å¥–</title>
<style>
  /* ç»Ÿä¸€ä¸»é¢˜è‰²å˜é‡ï¼Œä¾¿äºåç»­ä¿®æ”¹ */
  :root {
    --modal-overlay: rgba(0, 0, 0, 0.8);
    --modal-bg: #1a1a1a;
    --gold-primary: #ffd700;
    --gold-secondary: #ffc107;
    --gold-tertiary: #ffb300;
    --gold-dark: #e6b800; /* æ–°å¢æ·±é‡‘è‰²ï¼Œç”¨äºæ–‡å­—æè¾¹ */
    --gold-shadow: #ffecb3;
    --gold-glow: #fffacd;
    --text-white: #ffffff;
    --text-gray: #f5f5f5;
  }


  body {
    margin: 0;
    background: radial-gradient(circle, #222, #000);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: #fff;
    font-family: Arial;
  }

  .container {
    text-align: center;
  }

  canvas {
    display: block;
    margin: 0 auto;
  }

  button {
    margin: 12px 10px;
    padding: 10px 24px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #ffcc00, #ff6600);
    color: #000;
    box-shadow: 0 0 12px rgba(255,150,0,.8);
    transition: all 0.2s ease; /* æŒ‰é’®è¿‡æ¸¡åŠ¨ç”» */
  }

  button:disabled {
    opacity: .4;
    cursor: not-allowed;
  }

  #settingsBtn { position: absolute; top: 10px; right: 0; font-size: 24px;transition: all 0.2s ease; /* æŒ‰é’®è¿‡æ¸¡åŠ¨ç”» */ }

  textarea { width: 300px; height: 200px; margin-top: 10px; background: #222; color: #fff; border: 1px solid #555; border-radius: 6px; padding: 6px; }

  /* å¼¹æ¡†æ ·å¼ */
  /* å¼¹æ¡†é®ç½©å±‚ï¼ˆåˆå¹¶.modalå’Œ.prizeModalæ ·å¼ï¼‰- é»˜è®¤éšè— */
  .modal, .prizeModal {
    position: fixed;
    inset: 0;
    background: var(--modal-overlay);
    display: none; /* é»˜è®¤éšè—ï¼Œå…³é”®å±æ€§ */
    justify-content: center;
    align-items: center;
    z-index: 9999; /* ç¡®ä¿å¼¹æ¡†åœ¨æœ€ä¸Šå±‚ */
    transition: all 0.3s ease; /* è¿‡æ¸¡åŠ¨ç”»ï¼Œè®©æ˜¾ç¤º/éšè—æ›´å¹³æ»‘ */
    opacity: 0; /* é»˜è®¤é€æ˜ï¼Œé…åˆè¿‡æ¸¡åŠ¨ç”» */
  }

  /* å¼¹æ¡†å†…å®¹å®¹å™¨ï¼ˆåˆå¹¶.modal-boxå’Œ.prizeModal-boxæ ·å¼ï¼‰ */
  .modal-box, .prizeModal-box {
    background: var(--modal-bg);
    padding: 32px 40px; /* ä¼˜åŒ–å†…è¾¹è·ï¼Œä¸Šä¸‹å¤§äºå·¦å³ï¼Œæ›´åè°ƒ */
    border-radius: 16px; /* å¢å¤§åœ†è§’ï¼Œæ›´æŸ”å’Œç¾è§‚ */
    text-align: center;
    box-shadow: 0 0 20px var(--gold-primary), 0 0 40px var(--gold-shadow), 0 4px 16px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--gold-secondary); /* å¢åŠ é‡‘è‰²è¾¹æ¡†ï¼Œæå‡ç²¾è‡´æ„Ÿ */
    max-width: 90%; /* å“åº”å¼é™åˆ¶ï¼Œå°å±å¹•ä¸æº¢å‡º */
    width: 400px; /* å›ºå®šå®½åº¦ï¼Œå¤§å±æ›´è§„æ•´ */
    transform: scale(0.9); /* é»˜è®¤ç¼©å°ï¼Œé…åˆæ˜¾ç¤ºåŠ¨ç”» */
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* å¼¹æ¡†æ¿€æ´»ï¼ˆæ˜¾ç¤ºï¼‰æ—¶çš„æ ·å¼ - æ‰‹åŠ¨æ·»åŠ activeç±»æ‰ä¼šè§¦å‘ */
  .modal.active, .prizeModal.active {
    display: flex;
    opacity: 1; /* æ˜¾ç¤ºæ—¶ä¸é€æ˜ */
  }

  .modal.active .modal-box, .prizeModal.active .prizeModal-box {
    transform: scale(1.05); /* æ˜¾ç¤ºæ—¶æ”¾å¤§ï¼Œå¢å¼ºä»ªå¼æ„Ÿ */
  }

  /* æ ‡é¢˜æ ·å¼ä¼˜åŒ– */
  .modal-box h2, .prizeModal-box h2 {
    color: var(--gold-primary);
    font-size: 24px;
    font-weight: 700;
    margin: 0 0 20px 0; /* å¢åŠ åº•éƒ¨é—´è·ï¼Œæ‹‰å¼€ä¸å†…å®¹çš„è·ç¦» */
    text-shadow: 0 0 10px var(--gold-shadow); /* æ–‡å­—å‘å…‰ï¼Œå¢å¼ºå–œåº†æ„Ÿ */
  }

  
  /* ğŸ”¥ æ ¸å¿ƒä¼˜åŒ–ï¼šæ¸…æ™°+å‘å…‰çš„å¥–åŠ±æ–‡æœ¬æ ·å¼ */
  #result {
    font-size: 32px;
    font-weight: bold;
    color: #ffeb3b;
    text-align: center;
    margin: 20px 0;
    /* æè¾¹ */
    -webkit-text-stroke: 2px #ff3;   /* Chrome/Safari */
    text-stroke: 2px #ff3;            /* å…¶ä»–æ”¯æŒ */
    /* å‘¼å¸åŠ¨ç”» */
    animation: breathe 3s infinite alternate ease-in-out;
  }

  @keyframes breathe {
    0% {
      transform: scale(1);
      text-shadow: 0 0 5px #ffeb3b;
    }
    50% {
      transform: scale(1.15);          /* æ”¾å¤§ 15% */
      text-shadow: 0 0 15px #ffeb3b, 0 0 30px #ff3;
    }
    100% {
      transform: scale(1);
      text-shadow: 0 0 5px #ffeb3b;
    }
  }


  /* æŒ‰é’®æ ·å¼å…¨é¢ä¼˜åŒ– */
  .modal-box button, .prizeModal-box button {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary)); /* æ¸å˜èƒŒæ™¯ï¼Œæ›´æœ‰è´¨æ„Ÿ */
    color: #222;
    border: none;
    border-radius: 8px;
    padding: 12px 32px; /* ä¼˜åŒ–å†…è¾¹è·ï¼Œæå‡ç‚¹å‡»åŒºåŸŸ */
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease; /* æŒ‰é’®è¿‡æ¸¡åŠ¨ç”» */
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
  }

  /* æŒ‰é’®hoverçŠ¶æ€ï¼ˆäº¤äº’åé¦ˆï¼‰ */
  button:hover {
    color: #fff;
    background: linear-gradient(135deg, var(--gold-secondary), #ffb300);
    box-shadow: 0 6px 16px rgba(255, 215, 0, 0.6);
    transform: translateY(-2px); /* è½»å¾®ä¸Šç§»ï¼Œå¢å¼ºäº¤äº’æ„Ÿ */
  }

  /* æŒ‰é’®activeçŠ¶æ€ï¼ˆç‚¹å‡»åé¦ˆï¼‰ */
  button:active {
    color: #fff;
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
  }
</style>
</head>

<body>
<div class="container">
  <canvas id="canvas" width="600" height="600"></canvas>
  <div>
    <button id="startBtn">å¼€å§‹æŠ½å¥–</button>
    <button id="settingsBtn">âš™ï¸</button>
  </div>
</div>


<!-- ä¸­å¥–å¼¹æ¡† -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h2>ğŸ‰ æŠ½å¥–ç»“æœ</h2>
    <p id="result"></p>
    <button onclick="closeModal()">ç¡®è®¤</button>
  </div>
</div>

<!-- å¥–å“è®¾ç½®å¼¹æ¡† -->
<div class="prizeModal" id="prizeModal">
  <div class="prizeModal-box">
    <h2>é…ç½®å¥–å“ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</h2>
    <textarea id="prizeInput"></textarea>
    <br>
    <button onclick="savePrizes()">ä¿å­˜</button>
    <button onclick="closePrizeModal()">å–æ¶ˆ</button>
  </div>
</div>

<script>
const canvas = document.getElementById('canvas')
const ctx = canvas.getContext('2d')

const startBtn = document.getElementById('startBtn')
const settingsBtn = document.getElementById('settingsBtn');
const modal = document.getElementById('modal');
const result = document.getElementById('result');
const prizeModal = document.getElementById('prizeModal');
const prizeInput = document.getElementById('prizeInput');

const cx = canvas.width / 2
const cy = canvas.height / 2
const radius = 140

// å¥–å“
let prizes = [
  "ç›–ç é¥­", "å¼€å°èœ", "é‡‘æ‹±é—¨", "è¾¾ç¾ä¹", "èƒ¡å­å¤§å¨", "æ‘¸æ‘¸å®¶", "é™ˆé¦™è´µ", 
  "æ¥¼ä¸‹å…°å·æ‹‰é¢", "å¡”ä¸æ±€", "å…«å˜King", "æ¤’é”…é”…"
]
// ç¼“å­˜å¥–å“
const saved = localStorage.getItem('prizes')
if(saved){
  prizes = JSON.parse(saved)
}

// é¢œè‰²
const colors = prizes.map(() => randomColor())  // æ¯æ¬¡é‡æ–°ç”Ÿæˆ

// è½¬ç›˜çŠ¶æ€
let angle = 0
let speed = 0
let isSpinning = false
let targetAngle = 0

// æ¯å—æ‰‡åŒºè§’åº¦
let slice = Math.PI * 2 / prizes.length

// ç²’å­
const particles = []

class Particle {
  constructor() {
    this.x = cx
    this.y = cy
    const a = Math.random() * Math.PI * 2  // éšæœºæ–¹å‘
    const v = Math.random() * 8 + 3       // æ›´å¤§åˆé€Ÿåº¦
    this.vx = Math.cos(a) * v
    this.vy = Math.sin(a) * v
    this.life = 90 + Math.random() * 30   // æ›´é•¿å¯¿å‘½
    this.r = 3 + Math.random() * 2        // ç²’å­åŠå¾„
    this.color = `hsl(${Math.random()*360},100%,60%)`
  }
  update() {
    this.x += this.vx
    this.y += this.vy
    this.vy += 0.05  // é‡åŠ›
    this.life--
  }
  draw() {
    ctx.globalAlpha = Math.max(this.life / 120, 0)
    ctx.fillStyle = this.color
    ctx.beginPath()
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2)
    ctx.fill()
    ctx.globalAlpha = 1
  }
}

function randomColor() {
  const h = Math.floor(Math.random() * 360)  // è‰²ç›¸ 0~360
  const s = 70 + Math.random() * 30          // é¥±å’Œåº¦ 70~100%
  const l = 50 + Math.random() * 10          // æ˜åº¦ 50~60%
  return `hsl(${h},${s}%,${l}%)`
}

// ç»˜åˆ¶è½¬ç›˜
function drawWheel() {
  slice = Math.PI * 2 / prizes.length
  ctx.clearRect(0, 0, canvas.width, canvas.height)

  ctx.save()
  ctx.translate(cx, cy)
  ctx.rotate(angle)

  prizes.forEach((text, i) => {
    ctx.beginPath()
    ctx.fillStyle = colors[i]
    ctx.moveTo(0, 0)
    ctx.arc(0, 0, radius, i * slice, (i + 1) * slice)
    ctx.fill()

    // æ–‡æœ¬
    ctx.save()
    ctx.rotate(i * slice + slice / 2)
    ctx.fillStyle = '#fff'
    ctx.font = '16px Arial'
    ctx.textAlign = 'right'
    ctx.fillText(text, radius - 10, 5)
    ctx.restore()
  })

  ctx.restore()

  // æŒ‡é’ˆï¼ˆæœä¸‹ï¼ŒæŒ‡å‘åœ†å¿ƒï¼‰
  ctx.fillStyle = '#ffeb3b'
  ctx.beginPath()
  ctx.moveTo(cx, cy - radius + 22)   // å°–å¤´ï¼ˆé è¿‘è½¬ç›˜ï¼‰
  ctx.lineTo(cx - 12, cy - radius - 18) // å·¦ä¸Š
  ctx.lineTo(cx + 12, cy - radius - 18) // å³ä¸Š
  ctx.closePath()
  ctx.fill()
}

// åŠ¨ç”»å¾ªç¯
function animate() {
  drawWheel()

  // ç²’å­
  particles.forEach(p => {
    p.update()
    p.draw()
  })
  for (let i = particles.length - 1; i >= 0; i--) {
    if (particles[i].life <= 0) particles.splice(i, 1)
  }

  if (isSpinning) {
    angle += speed
    speed *= 0.985

    // æ¥è¿‘ç›®æ ‡ï¼Œåœæ­¢
    if (speed < 0.002) {
      isSpinning = false
      explode()
      
      setTimeout(showResult, 300)
    }
  }

  requestAnimationFrame(animate)
}

// ç²’å­çˆ†å‘
function explode() {
  const count = 300 + Math.floor(Math.random() * 200)  // 300~500é¢—
  for (let i=0; i<count; i++) particles.push(new Particle())
}

// æ˜¾ç¤ºç»“æœ
function showResult() {
  const index = getPrizeIndex()
  console.log(`è·å¥–ç´¢å¼•: ${index}`)
  // alert(`ğŸ‰ GOç‚«é¥­ï¼š${prizes[index]}`)
  result.innerText = `${prizes[index]}`;
  modal.classList.add('active');
  startBtn.disabled=false;
}

// å½“å‰æŒ‡é’ˆæ–¹å‘å¯¹åº”çš„å¥–é¡¹ç´¢å¼•
function getPrizeIndex() {
  const slice = Math.PI * 2 / prizes.length

  // è½¬ç›˜å½“å‰è§’åº¦
  let normalizedAngle = angle % (Math.PI * 2)
  if (normalizedAngle < 0) normalizedAngle += Math.PI * 2

  // ç®­å¤´åœ¨æ­£ä¸Šæ–¹ï¼Œåç§» -Ï€/2
  let arrowAngle = (normalizedAngle + Math.PI/2) % (Math.PI*2)

  // é¡ºæ—¶é’ˆè®¡ç®—å½“å‰æ‰‡åŒº
  let index = Math.floor(arrowAngle / slice)

  // å¥–é¡¹æ•°ç»„é¡ºåºå¯èƒ½ä¸ Canvas æ‰‡åŒºé¡ºåºåå‘
  // ä¿®æ­£åç§» 1 ä¸ª
  index = (prizes.length - index - 1 + prizes.length) % prizes.length

  return index
}

// å¼€å§‹æŠ½å¥–
startBtn.onclick = () => {
  if (isSpinning) return
  startBtn.disabled = true

  // ğŸ‘‰ è¿™é‡Œå¯æ›¿æ¢ä¸ºåç«¯è¿”å›çš„ index
  const finalIndex = Math.floor(Math.random() * prizes.length)

  targetAngle =
    Math.PI * 2 * 6 +
    (prizes.length - finalIndex) * slice -
    slice / 2

  speed = 0.35
  isSpinning = true
}

// è®¾ç½®å¥–å“
settingsBtn.onclick = ()=>{
  prizeInput.value = prizes.join('\n');
  prizeModal.classList.add('active');
}

function savePrizes(){
  const lines = prizeInput.value.split('\n').map(l=>l.trim()).filter(l=>l);
  if(lines.length>0){
    prizes = lines;
    localStorage.setItem('prizes', JSON.stringify(prizes))
  }
  prizeModal.classList.remove('active');
  drawWheel();
}

function closeModal(){ modal.classList.remove('active'); }
function closePrizeModal(){ prizeModal.classList.remove('active'); }

// å¯åŠ¨
animate()
</script>
</body>
</html>
