<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Canvasç²’å­è½¬ç›˜æŠ½å¥–</title>
<style>
  /* åŸºç¡€é‡ç½® */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* 1. å®šä¹‰ä¸¤å¥—ä¸»é¢˜å˜é‡ï¼šæš—é»‘ï¼ˆé»˜è®¤ï¼‰+ æ˜äº® */
  :root {
    /* æš—é»‘ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰ */
    --modal-overlay: rgba(0, 0, 0, 0.85);
    --modal-bg: #1a1a1a;
    --modal-bg-gradient: linear-gradient(135deg, #1a1a1a, #222);
    --gold-primary: #ffd700;
    --gold-secondary: #ffc107;
    --gold-tertiary: #ffb300;
    --gold-dark: #e6b800;
    --gold-shadow: #ffecb3;
    --gold-glow: #fffacd;
    --text-white: #ffffff;
    --text-gray: #f5f5f5;
    --wheel-shadow: rgba(0,0,0,0.3);
    --body-bg: radial-gradient(circle at center, #2a2a2a, #000);
    --btn-text: #333;
    --textarea-bg: #222;
    --textarea-border: #ffc107;
  }

  /* æ˜äº®ä¸»é¢˜ */
  :root[data-theme="light"] {
    --modal-overlay: rgba(255, 255, 255, 0.85);
    --modal-bg: #f8f9fa;
    --modal-bg-gradient: linear-gradient(135deg, #f8f9fa, #e9ecef);
    --gold-primary: #e6c200;
    --gold-secondary: #d4a800;
    --gold-tertiary: #c29400;
    --gold-dark: #b08000;
    --gold-shadow: #ffe880;
    --gold-glow: #fff2cc;
    --text-white: #212529;
    --text-gray: #495057;
    --wheel-shadow: rgba(0,0,0,0.1);
    --body-bg: radial-gradient(circle at center, #f5f5f5, #e9ecef);
    --btn-text: #212529;
    --textarea-bg: #ffffff;
    --textarea-border: #d4a800;
  }

  body {
    background: var(--body-bg);
    background-size: 150% 150%;
    animation: bgFloat 15s ease-in-out infinite alternate;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: var(--text-white);
    font-family: "Microsoft Yahei", Arial, sans-serif;
    overflow: hidden;
    transition: background 0.5s ease;
  }

  /* èƒŒæ™¯æµ®åŠ¨åŠ¨ç”» */
  @keyframes bgFloat {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
  }

  .container {
    text-align: center;
    position: relative;
    animation: containerBreathe 8s ease-in-out infinite alternate;
  }

  @keyframes containerBreathe {
    0% { transform: scale(1); }
    100% { transform: scale(1.02); }
  }

  /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
  #themeToggle {
    position: absolute;
    top: 10px;
    left: 0;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    background: rgba(255,215,0,0.1);
    border: 1px solid var(--gold-secondary);
    color: var(--gold-primary);
    transition: all 0.3s ease;
    cursor: pointer;
    font-size: 24px;
  }

  canvas {
    display: block;
    margin: 0 auto;
    box-shadow: 0 0 30px rgba(255,215,0,0.2), 0 0 60px var(--wheel-shadow);
    border-radius: 50%;
    image-rendering: optimizeQuality;
    image-rendering: -webkit-optimize-contrast;
  }

  /* æŒ‰é’®æ ·å¼å…¨é¢å‡çº§ */
  #startBtn {
    margin: 20px 10px 10px;
    padding: 12px 32px;
    font-size: 18px;
    font-weight: 700;
    border-radius: 50px;
    border: 2px solid var(--gold-primary);
    cursor: pointer;
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-tertiary));
    color: var(--btn-text);
    box-shadow: 0 4px 15px rgba(255,150,0,.8), 0 0 20px rgba(255,215,0,0.3);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
  }

  /* æŒ‰é’®å†…éƒ¨å‘å…‰åŠ¨æ•ˆ */
  #startBtn::after {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
    transform: rotate(45deg);
    animation: btnShine 3s ease-in-out infinite;
  }

  @keyframes btnShine {
    0% { transform: rotate(45deg) translateX(-100%); }
    100% { transform: rotate(45deg) translateX(100%); }
  }

  #settingsBtn { 
    position: absolute; 
    top: 10px; 
    right: 0; 
    font-size: 24px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    background: rgba(255,215,0,0.1);
    border: 1px solid var(--gold-secondary);
    color: var(--gold-primary);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  textarea { 
    width: 320px; 
    height: 220px; 
    margin-top: 10px; 
    background: var(--textarea-bg); 
    color: var(--text-white); 
    border: 1px solid var(--textarea-border); 
    border-radius: 8px; 
    padding: 10px;
    font-size: 14px;
    resize: none;
    transition: all 0.2s ease;
  }

  textarea:focus {
    outline: none;
    border-color: var(--gold-primary);
    box-shadow: 0 0 10px rgba(255,215,0,0.3);
  }

  /* å¼¹æ¡†æ ·å¼ä¼˜åŒ– */
  .modal, .prizeModal {
    position: fixed;
    inset: 0;
    background: var(--modal-overlay);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    opacity: 0;
    backdrop-filter: blur(5px);
  }

  .modal-box, .prizeModal-box {
    background: var(--modal-bg-gradient);
    padding: 36px 40px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 0 30px var(--gold-primary), 0 0 60px var(--gold-shadow), 0 8px 24px rgba(0, 0, 0, 0.6);
    border: 2px solid var(--gold-secondary);
    max-width: 90%;
    width: 420px;
    transform: scale(0.85) translateY(20px);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
    color: var(--text-white);
  }

  /* å¼¹æ¡†èƒŒæ™¯è£…é¥° */
  .modal-box::before, .prizeModal-box::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at top right, rgba(255,215,0,0.1), transparent 70%);
    pointer-events: none;
  }

  .modal.active, .prizeModal.active {
    display: flex;
    opacity: 1;
  }

  .modal.active .modal-box, .prizeModal.active .prizeModal-box {
    transform: scale(1.02) translateY(0);
  }

  /* æ ‡é¢˜æ ·å¼ä¼˜åŒ– */
  .modal-box h2, .prizeModal-box h2 {
    color: var(--gold-primary);
    font-size: 28px;
    font-weight: 800;
    margin: 0 0 24px 0;
    text-shadow: 0 0 15px var(--gold-shadow), 0 2px 4px rgba(0,0,0,0.5);
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-tertiary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  /* æ ¸å¿ƒä¼˜åŒ–ï¼šæ¸…æ™°+å‘å…‰çš„å¥–åŠ±æ–‡æœ¬æ ·å¼ */
  #result {
    font-size: 36px;
    font-weight: 800;
    text-align: center;
    margin: 20px 0 30px;
    background: linear-gradient(135deg, #fff, var(--gold-primary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    -webkit-text-stroke: 2px var(--gold-dark);
    text-stroke: 2px var(--gold-dark);
    animation: breathe 2s infinite alternate ease-in-out;
    letter-spacing: 2px;
  }

  @keyframes breathe {
    0% {
      transform: scale(1);
      text-shadow: 0 0 10px var(--gold-shadow), 0 0 20px var(--gold-glow);
    }
    100% {
      transform: scale(1.2);          
      text-shadow: 0 0 20px var(--gold-shadow), 0 0 40px var(--gold-glow), 0 0 60px var(--gold-primary);
    }
  }

  /* å¼¹æ¡†æŒ‰é’®æ ·å¼ */
  .modal-box button, .prizeModal-box button {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: var(--btn-text);
    border: none;
    border-radius: 50px;
    padding: 12px 36px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    margin: 20px 20px;
  }

  /* é€šç”¨æŒ‰é’®äº¤äº’æ•ˆæœ */
  button:hover:not(:disabled) {
    color: #fff;
    background: linear-gradient(135deg, var(--gold-secondary), var(--gold-tertiary));
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
    transform: translateY(-3px);
  }

  button:active:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 2px 10px rgba(255, 215, 0, 0.4);
  }

  button:disabled {
    opacity: .4;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
  }
</style>
</head>

<body>
<div class="container">
  <!-- æ–°å¢ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
  <button id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
  <canvas id="canvas" width="600" height="600"></canvas>
  <div>
    <button id="startBtn">å¼€å§‹æŠ½å¥–</button>
    <button id="settingsBtn" title="é…ç½®å¥–å“">âš™ï¸</button>
  </div>
</div>

<!-- ä¸­å¥–å¼¹æ¡† -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h2>ğŸ‰ æ­å–œæŠ½ä¸­</h2>
    <p id="result"></p>
    <button onclick="closeModal()">ç¡®è®¤</button>
  </div>
</div>

<!-- å¥–å“è®¾ç½®å¼¹æ¡† -->
<div class="prizeModal" id="prizeInputModal">
  <div class="prizeModal-box">
    <h2>ğŸ é…ç½®å¥–å“ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</h2>
    <textarea id="prizeInput" placeholder="è¯·è¾“å…¥å¥–å“åç§°ï¼Œæ¯è¡Œä¸€ä¸ª"></textarea>
    <br>
    <button onclick="savePrizes()">ä¿å­˜</button>
    <button onclick="closePrizeModal()">å–æ¶ˆ</button>
  </div>
</div>

<script>
// ========== 1. ä¿®å¤æ ¸å¿ƒè¯­æ³•é”™è¯¯ + ä¸»é¢˜åˆ‡æ¢é€»è¾‘ ==========
// è·å–æ ¹å…ƒç´ 
const root = document.documentElement;
// ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
const themeToggle = document.getElementById('themeToggle');
// æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜ï¼ˆä¼˜å…ˆçº§é«˜äºç³»ç»Ÿï¼‰
const savedTheme = localStorage.getItem('appTheme');

// æ£€æµ‹ç³»ç»Ÿä¸»é¢˜åå¥½
function detectSystemTheme() {
  return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
}

// è®¾ç½®ä¸»é¢˜
function setTheme(theme) {
  root.setAttribute('data-theme', theme);
  localStorage.setItem('appTheme', theme);
  // æ›´æ–°æŒ‰é’®å›¾æ ‡
  themeToggle.innerText = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
}

// åˆå§‹åŒ–ä¸»é¢˜ï¼ˆä¼˜å…ˆæœ¬åœ°å­˜å‚¨ï¼Œå…¶æ¬¡ç³»ç»Ÿï¼‰
if (savedTheme) {
  setTheme(savedTheme);
} else {
  setTheme(detectSystemTheme());
}

// ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
themeToggle.addEventListener('click', () => {
  const currentTheme = root.getAttribute('data-theme') || 'dark';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  setTheme(newTheme);
});

// ä¿®å¤ï¼šæ›¿æ¢å…³é”®å­—varä¸ºåˆæ³•çš„å‡½æ•°å
function getCssVar(varName) {
  return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
}

// ========== 2. åŸæœ‰åŠŸèƒ½é€»è¾‘ ==========
const canvas = document.getElementById('canvas')
const ctx = canvas.getContext('2d')

const startBtn = document.getElementById('startBtn')
const settingsBtn = document.getElementById('settingsBtn');
const modal = document.getElementById('modal');
const result = document.getElementById('result');
const prizeModal = document.getElementById('prizeInputModal'); // ä¿®å¤IDå‘½åå†²çª
const prizeInput = document.getElementById('prizeInput');

// è§£å†³Canvasé”¯é½¿é—®é¢˜
const dpr = window.devicePixelRatio || 1
const canvasWidth = canvas.width
const canvasHeight = canvas.height
canvas.width = canvasWidth * dpr
canvas.height = canvasHeight * dpr
canvas.style.width = `${canvasWidth}px`
canvas.style.height = `${canvasHeight}px`
ctx.scale(dpr, dpr)

const cx = canvasWidth / 2
const cy = canvasHeight / 2
const radius = 140

// å¥–å“
let prizes = [
  "ç›–ç é¥­", "å¼€å°èœ", "é‡‘æ‹±é—¨", "è¾¾ç¾ä¹", "èƒ¡å­å¤§å¨", "æ‘¸æ‘¸å®¶", "é™ˆé¦™è´µ", 
  "æ¥¼ä¸‹å…°å·æ‹‰é¢", "å¡”ä¸æ±€", "å…«å˜King", "æ¤’é”…é”…"
]
// ç¼“å­˜å¥–å“
const savedPrizes = localStorage.getItem('prizes')
if(savedPrizes){
  prizes = JSON.parse(savedPrizes)
}

// é¢œè‰² - ä¼˜åŒ–ä¸ºæ›´åè°ƒçš„é…è‰²
const colors = prizes.map(() => randomColor())

// è½¬ç›˜çŠ¶æ€
let angle = 0
let speed = 0
let isSpinning = false
let targetAngle = 0

// æ¯å—æ‰‡åŒºè§’åº¦
let slice = Math.PI * 2 / prizes.length

// ç²’å­
const particles = []

class Particle {
  constructor() {
    this.x = cx
    this.y = cy
    const a = Math.random() * Math.PI * 2  // éšæœºæ–¹å‘
    const v = Math.random() * 10 + 5       // ä¼˜åŒ–åˆé€Ÿåº¦ï¼Œæ›´çµåŠ¨
    this.vx = Math.cos(a) * v
    this.vy = Math.sin(a) * v
    this.life = 120 + Math.random() * 50   // ä¼˜åŒ–å¯¿å‘½
    this.r = 2 + Math.random() * 3         // ä¼˜åŒ–ç²’å­å¤§å°
    // ç²’å­é¢œè‰²è´´åˆä¸»é¢˜ï¼ˆé‡‘è‰²ç³»ï¼‰
    this.color = `hsl(${40 + Math.random()*20},100%,${50 + Math.random()*20}%)`
  }
  update() {
    this.x += this.vx
    this.y += this.vy
    this.vy += 0.03  // ä¼˜åŒ–é‡åŠ›ï¼Œæ›´è‡ªç„¶
    // æ·»åŠ ç©ºæ°”é˜»åŠ›
    this.vx *= 0.98
    this.vy *= 0.98
    this.life--
  }
  draw() {
    ctx.globalAlpha = Math.max(this.life / 150, 0)
    ctx.fillStyle = this.color
    ctx.beginPath()
    ctx.arc(this.x,this.y,this.r,0,Math.PI*2)
    ctx.fill()
    ctx.globalAlpha = 1
  }
}

// ä¼˜åŒ–éšæœºé¢œè‰²ç®—æ³•ï¼Œæ›´åè°ƒ
function randomColor() {
  // é™å®šåœ¨æš–è‰²ç³»ï¼Œæ›´è´´åˆæŠ½å¥–ä¸»é¢˜
  const h = 20 + Math.floor(Math.random() * 60)  
  const s = 80 + Math.random() * 20          
  const l = 45 + Math.random() * 15          
  return `hsl(${h},${s}%,${l}%)`
}

// ç»˜åˆ¶è½¬ç›˜ - å…¨é¢ä¼˜åŒ–ï¼Œè§£å†³é”¯é½¿+æå‡è´¨æ„Ÿ
function drawWheel() {
  slice = Math.PI * 2 / prizes.length
  ctx.clearRect(0, 0, canvasWidth, canvasHeight)

  // å¼€å¯æŠ—é”¯é½¿
  ctx.imageSmoothingEnabled = true
  ctx.imageSmoothingQuality = "high"

  // ç»˜åˆ¶è½¬ç›˜å¤–æ¡†ï¼Œæå‡ç²¾è‡´åº¦
  ctx.save()
  ctx.translate(cx, cy)
  ctx.beginPath()
  ctx.arc(0, 0, radius + 5, 0, Math.PI * 2)
  ctx.fillStyle = "#111"
  ctx.fill()
  ctx.beginPath()
  ctx.arc(0, 0, radius + 3, 0, Math.PI * 2)
  ctx.fillStyle = getCssVar('--gold-dark') // ä¿®å¤ï¼šä½¿ç”¨åˆæ³•å‡½æ•°å
  ctx.fill()
  ctx.restore()

  ctx.save()
  ctx.translate(cx, cy)
  ctx.rotate(angle)

  prizes.forEach((text, i) => {
    ctx.beginPath()
    // ç»˜åˆ¶æ‰‡åŒºï¼Œæ·»åŠ æ¸å˜æå‡è´¨æ„Ÿ
    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, radius)
    gradient.addColorStop(0, lightenColor(colors[i], 10))
    gradient.addColorStop(1, colors[i])
    ctx.fillStyle = gradient
    ctx.moveTo(0, 0)
    ctx.arc(0, 0, radius, i * slice, (i + 1) * slice)
    ctx.fill()

    // ç»˜åˆ¶æ‰‡åŒºåˆ†å‰²çº¿ï¼Œè§£å†³é”¯é½¿æ„Ÿ
    ctx.strokeStyle = "#fff"
    ctx.lineWidth = 1.5
    ctx.moveTo(0, 0)
    ctx.lineTo(radius * Math.cos(i * slice), radius * Math.sin(i * slice))
    ctx.stroke()

    // æ–‡æœ¬ - ä¼˜åŒ–æ ·å¼ï¼Œæ›´æ¸…æ™°
    ctx.save()
    ctx.rotate(i * slice + slice / 2)
    // æ–‡æœ¬æ·»åŠ æè¾¹ï¼Œæ›´æ¸…æ™°
    ctx.fillStyle = '#fff'
    ctx.font = 'bold 16px "Microsoft Yahei", Arial'
    ctx.textAlign = 'right'
    ctx.textBaseline = 'middle'
    // ç»˜åˆ¶æ–‡å­—é˜´å½±ï¼Œæå‡å¯è¯»æ€§
    ctx.shadowColor = 'rgba(0,0,0,0.5)'
    ctx.shadowBlur = 2
    ctx.shadowOffsetX = 1
    ctx.shadowOffsetY = 1
    ctx.fillText(text, radius - 15, 0)
    ctx.shadowColor = 'transparent'
    ctx.restore()
  })

  ctx.restore()

  // æŒ‡é’ˆä¼˜åŒ– - æ›´ç²¾è‡´ï¼Œæ·»åŠ æ¸å˜å’Œå‘å…‰
  ctx.save()
  // æŒ‡é’ˆå‘¼å¸åŠ¨æ•ˆï¼ˆéæ—‹è½¬æ—¶ï¼‰
  const pointerScale = isSpinning ? 1 : (1 + Math.sin(Date.now() / 500) * 0.05)
  ctx.translate(cx, cy - radius + 10)
  ctx.scale(pointerScale, pointerScale)
  
  // æŒ‡é’ˆæ¸å˜
  const pointerGradient = ctx.createLinearGradient(-12, -18, 12, 22)
  pointerGradient.addColorStop(0, '#fff')
  pointerGradient.addColorStop(1, getCssVar('--gold-primary')) // ä¿®å¤ï¼šä½¿ç”¨åˆæ³•å‡½æ•°å
  ctx.fillStyle = pointerGradient
  ctx.beginPath()
  ctx.moveTo(0, 22)   // å°–å¤´
  ctx.lineTo(-12, -18) // å·¦ä¸Š
  ctx.lineTo(12, -18) // å³ä¸Š
  ctx.closePath()
  ctx.fill()
  
  // æŒ‡é’ˆæè¾¹ï¼Œè§£å†³é”¯é½¿
  ctx.strokeStyle = getCssVar('--gold-dark') // ä¿®å¤ï¼šä½¿ç”¨åˆæ³•å‡½æ•°å
  ctx.lineWidth = 1
  ctx.stroke()
  
  // æŒ‡é’ˆå‘å…‰æ•ˆæœ
  ctx.shadowColor = getCssVar('--gold-glow') // ä¿®å¤ï¼šä½¿ç”¨åˆæ³•å‡½æ•°å
  ctx.shadowBlur = 10
  ctx.fill()
  ctx.shadowColor = 'transparent'
  
  ctx.restore()
}

// è¾…åŠ©å‡½æ•°ï¼šè°ƒæ•´é¢œè‰²äº®åº¦
function lightenColor(color, percent) {
  const hsl = color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/)
  if (hsl) {
    const h = hsl[1]
    const s = hsl[2]
    let l = parseInt(hsl[3]) + percent
    l = Math.min(100, Math.max(0, l))
    return `hsl(${h},${s}%,${l}%)`
  }
  return color
}

// åŠ¨ç”»å¾ªç¯
function animate() {
  drawWheel()

  // ç²’å­
  particles.forEach(p => {
    p.update()
    p.draw()
  })
  for (let i = particles.length - 1; i >= 0; i--) {
    if (particles[i].life <= 0) particles.splice(i, 1)
  }

  if (isSpinning) {
    angle += speed
    speed *= 0.985

    // æ¥è¿‘ç›®æ ‡ï¼Œåœæ­¢
    if (speed < 0.002) {
      isSpinning = false
      explode()
      setTimeout(showResult, 500) // å»¶è¿Ÿæ›´é•¿ï¼Œç²’å­æ•ˆæœæ›´å®Œæ•´
    }
  } else {
    // é™æ­¢æ—¶è½»å¾®æ—‹è½¬ï¼Œå¢åŠ çµåŠ¨æ€§
    angle += 0.001
  }

  requestAnimationFrame(animate)
}

// ç²’å­çˆ†å‘ - ä¼˜åŒ–æ•ˆæœ
function explode() {
  const count = 400 + Math.floor(Math.random() * 200)  // æ›´å¤šç²’å­
  for (let i=0; i<count; i++) particles.push(new Particle())
}

// æ˜¾ç¤ºç»“æœ
function showResult() {
  const index = getPrizeIndex()
  result.innerText = `${prizes[index]}`;
  // å¼¹æ¡†æ˜¾ç¤ºå‰æ·»åŠ ç¼©æ”¾åŠ¨ç”»
  modal.classList.add('active');
  startBtn.disabled=false;
}

// å½“å‰æŒ‡é’ˆæ–¹å‘å¯¹åº”çš„å¥–é¡¹ç´¢å¼•
function getPrizeIndex() {
  const slice = Math.PI * 2 / prizes.length

  // è½¬ç›˜å½“å‰è§’åº¦
  let normalizedAngle = angle % (Math.PI * 2)
  if (normalizedAngle < 0) normalizedAngle += Math.PI * 2

  // ç®­å¤´åœ¨æ­£ä¸Šæ–¹ï¼Œåç§» -Ï€/2
  let arrowAngle = (normalizedAngle + Math.PI/2) % (Math.PI*2)

  // é¡ºæ—¶é’ˆè®¡ç®—å½“å‰æ‰‡åŒº
  let index = Math.floor(arrowAngle / slice)

  // ä¿®æ­£åç§»
  index = (prizes.length - index - 1 + prizes.length) % prizes.length

  return index
}

// å¼€å§‹æŠ½å¥–
startBtn.onclick = () => {
  if (isSpinning) return
  startBtn.disabled = true

  // éšæœºæœ€ç»ˆå¥–é¡¹
  const finalIndex = Math.floor(Math.random() * prizes.length)

  targetAngle =
    Math.PI * 2 * 8 +  // å¤šè½¬å‡ åœˆï¼Œæ›´æœ‰ä»ªå¼æ„Ÿ
    (prizes.length - finalIndex) * slice -
    slice / 2

  speed = 0.4 // æ›´å¿«çš„åˆå§‹é€Ÿåº¦
  isSpinning = true
}

// è®¾ç½®å¥–å“
settingsBtn.onclick = ()=>{
  prizeInput.value = prizes.join('\n');
  prizeModal.classList.add('active');
}

function savePrizes(){
  const lines = prizeInput.value.split('\n').map(l=>l.trim()).filter(l=>l);
  if(lines.length>0){
    prizes = lines;
    // é‡æ–°ç”Ÿæˆé¢œè‰²
    colors.length = 0
    colors.push(...prizes.map(() => randomColor()))
    localStorage.setItem('prizes', JSON.stringify(prizes))
  }
  prizeModal.classList.remove('active');
  drawWheel();
}

function closeModal(){ 
  modal.classList.remove('active'); 
  // å…³é—­åé‡ç½®ç²’å­
  particles.length = 0
}
function closePrizeModal(){ prizeModal.classList.remove('active'); }

// å¯åŠ¨
animate()
</script>
</body>
</html>